feature: github-actions-cicd-pipeline
prd: ./prd-github-actions-cicd-pipeline.md
created_at: 2026-01-29T11:02:16.293Z
updated_at: 2026-01-29T11:02:16.293Z

tasks:
  - id: task-001
    title: "Create .github/workflows directory structure"
    description: |
      Initialize GitHub Actions workflow directory structure in the repository. Create the .github/workflows/ directory and set up proper permissions for workflow execution.
    status: completed
    dependencies: []
    acceptance_criteria:
      - ".github/workflows directory exists"
      - "Directory has proper git tracking"
      - "Structure follows GitHub Actions conventions"
    completed_at: 2026-01-29T11:03:45.123Z

  - id: task-002
    title: "Implement CI validation workflow"
    description: |
      Create comprehensive CI workflow that runs on PRs and master commits. Include test execution, type checking, and build validation using Bun runtime environment.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "Workflow triggers on PR to master and master commits"
      - "Tests run with 'bun test' command"
      - "Type checking executes successfully"
      - "Build validation runs with 'bun run build'"
      - "Workflow fails fast on first error"
    completed_at: 2026-01-29T11:07:22.456Z

  - id: task-003
    title: "Create manual major release workflow"
    description: |
      Implement workflow dispatch trigger for major version releases. Handle version bumping from current to next major version (e.g., 1.2.3 ‚Üí 2.0.0) with package.json updates and git tag creation.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "Manual trigger via workflow_dispatch available"
      - "Major version incremented correctly"
      - "package.json version field updated"
      - "Git tag created with new version"
      - "Release confirmation prompt included"
    completed_at: 2026-01-29T14:47:23.456Z

  - id: task-004
    title: "Create manual minor release workflow"
    description: |
      Implement workflow dispatch trigger for minor version releases. Handle version bumping from current to next minor version (e.g., 1.1.5 ‚Üí 1.2.0) with package.json updates and git tag creation.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "Manual trigger via workflow_dispatch available"
      - "Minor version incremented correctly"
      - "package.json version field updated"
      - "Git tag created with new version"
      - "Release confirmation prompt included"
    completed_at: 2026-01-29T15:45:12.789Z

  - id: task-005
    title: "Implement binary build and artifact attachment"
    description: |
      Add binary compilation step to release workflows using 'bun run build' command. Attach generated standalone binary to GitHub releases with proper version tagging.
    status: completed
    dependencies:
      - task-003
      - task-004
    acceptance_criteria:
      - "Standalone binary builds successfully"
      - "Binary attached to GitHub release"
      - "Artifact properly named with version"
      - "Build completes within time constraints"
      - "Binary is executable and functional"
    completed_at: 2026-01-29T16:45:32.000Z

  - id: task-006
    title: "Add GitHub release creation with auto-generated notes"
    description: |
      Integrate GitHub Release creation into version workflows with automatic release notes generation from commit history. Configure proper release metadata and changelog formatting.
    status: completed
    dependencies:
      - task-005
    acceptance_criteria:
      - "GitHub release created automatically"
      - "Release notes generated from commit history"
      - "Release title includes version number"
      - "Release marked as latest appropriately"
      - "Idempotent - safe to re-run workflows"
    completed_at: 2026-01-29T16:52:18.000Z

  - id: task-007
    title: "Configure Bun runtime environment for all workflows"
    description: |
      Set up consistent Bun runtime environment across all GitHub Actions workflows using actions/setup-bun. Ensure version consistency and proper caching configuration.
    status: completed
    dependencies:
      - task-002
      - task-003
      - task-004
    acceptance_criteria:
      - "Bun action configured in all workflows"
      - "Consistent Bun version across workflows"
      - "Dependency caching enabled"
      - "Runtime setup completes quickly"
      - "All Bun commands execute successfully"
    completed_at: 2026-01-29T17:25:14.000Z

  - id: task-008
    title: "Add workflow error handling and resource optimization"
    description: |
      Implement proper error handling, timeout configurations, and resource conservation measures. Ensure workflows fail fast and conserve GitHub Actions minutes.
    status: completed
    dependencies:
      - task-007
    acceptance_criteria:
      - "Workflows complete within 10 minute limit"
      - "Fail-fast behavior on first error"
      - "Proper timeout configurations set"
      - "Resource usage optimized"
      - "Clear error messages in failed runs"
    completed_at: 2026-01-29T17:58:42.000Z

  - id: task-009
    title: "Name the binary following common convention for macos binaries"
    description: |
      Name the macos binary in the GH release following common convention. and make it a zip file.
    status: completed
    dependencies: []
    acceptance_criteria:
      - "the github release artifact name follows common convention"
      - "the macos binary is named following common convention"
      - "the macos binary is zipped"
    completed_at: 2026-01-29T19:15:00.000Z

  - id: task-010
    title: "also publish releases to npm"
    description: |
      publish the release to npm as well as to gh release.
    status: completed
    dependencies:
    acceptance_criteria:
      - "the release is published to npm"
    completed_at: 2026-01-29T21:30:15.000Z

  - id: task-011
    title: "actions not showing up on github"
    description: |
      the github actions are not showing up on github
    status: completed
    dependencies:
    acceptance_criteria:
      - "the github actions are showing up on github"
    completed_at: 2026-01-29T23:15:00.000Z

  - id: task-012
    title: "fix ci error"
    description: |
      See error from test & validation job
      https://github.com/oskarhane/hone-ai/actions/runs/21480629076/job/61875801532

      Run echo "üì¶ Installing dependencies..."
      üì¶ Installing dependencies...
      bun install v1.1.42 (50eec002)
      2 |   "lockfileVersion": 1,
                              ^
      error: Unknown lockfile version
          at bun.lock:2:22
      InvalidLockfileVersion: failed to parse lockfile: 'bun.lock'

      warn: Ignoring lockfile
      error: lockfile had changes, but lockfile is frozen
      ‚ùå Dependency installation failed
      ‚ÑπÔ∏è  Check network connectivity and lockfile integrity
      Error: Process completed with exit code 1.
    status: completed
    dependencies:
    acceptance_criteria:
      - "run works on github"
    completed_at: 2026-01-29T23:52:00.000Z

  - id: task-013
    title: "fix ci error"
    description: |
      See error from minor release job
      0s
      0s
      Run NEW_VERSION="0.2.0"
        NEW_VERSION="0.2.0"
        git tag -a "v$NEW_VERSION" -m "Release version $NEW_VERSION"
         git push origin "v$NEW_VERSION"
         git push origin master
        shell: /usr/bin/bash -e {0}
        env:
          CI: true
          BUN_INSTALL_CACHE_DIR: ~/.bun/install/cache
      remote: Permission to oskarhane/hone-ai.git denied to github-actions[bot].
      fatal: unable to access 'https://github.com/oskarhane/hone-ai/': The requested URL returned error: 403
      Error: Process completed with exit code 128.

      See https://graphite.com/guides/how-to-automate-tagging-and-release-workflows-in-github for info on tagging and realeasing.
    status: completed
    dependencies:
    acceptance_criteria:
      - "run works on github"
    completed_at: 2026-01-29T12:52:30.000Z

  - id: task-014
    title: "finx macos unpacked binary name"
    description: |
      after downloading the macos binary from the release page, I see that the filename is "hone-macos" whic it shouldn't be. It should just be "hone"
    status: completed
    dependencies:
    acceptance_criteria:
      - "the unpacked binary name is hone"
    completed_at: 2026-01-29T23:59:45.000Z

  - id: task-015
    title: "use oidc tokens for npm releases"
    description: |
      we don't want ti use long lived npm tokens for releases
      we want to use oidc tokens for npm releases from github
      See https://docs.npmjs.com/trusted-publishers
    status: completed
    dependencies:
    acceptance_criteria:
      - "the requirement for NPM_TOKEN is gone"
      - "the release process for both mninor and major uses oidc tokens for npm"
    completed_at: 2026-01-29T12:03:00.000Z

  - id: task-016
    title: "have a single release to npm worksflow"
    description: |
      the npm settings for oidc requires specification of a single github workflow
      to allow publishing from.
      Right now we have two workflows, one for minor and one for major releases and both publish to npm.
      still automatically publish to npm if possible, but if not manual is ok.
      Feel free to web search for more information on how to configure oidc tokens for npm releases.
      https://docs.npmjs.com/trusted-publishers#supported-cicd-providers
    status: completed
    dependencies:
    acceptance_criteria:
      - "single github workflow for the publishing to npm"
    completed_at: 2026-01-29T12:15:30.000Z

  - id: task-017
    title: "fix workflow issue"
    description: |
      see issue:
        https://github.com/oskarhane/hone-ai/actions/runs/21485493165
      Invalid workflow file: .github/workflows/release-minor.yml#L265
      The workflow is not valid. .github/workflows/release-minor.yml (Line: 265, Col: 3): Error calling workflow 'oskarhane/hone-ai/.github/workflows/publish-npm.yml@fcb65249f20e0b2ff8782047909b478792c3161f'. The workflow is requesting 'id-token: write', but is only allowed 'id-token: none'.

      As stated earlier. if impossible to automatically publish to npm, we can manually publish to npm as a separate manual workflow.
    status: completed
    dependencies:
    acceptance_criteria:
      - "the workflows with publish to npm with oidc works"
    completed_at: 2026-01-29T12:30:00.000Z

  - id: task-018
    title: "fix version bump"
    description: |
      see issue:
        Run CURRENT_VERSION=$(bun --print 'JSON.parse(require("fs").readFileSync("package.json", "utf8")).version')
          CURRENT_VERSION=$(bun --print 'JSON.parse(require("fs").readFileSync("package.json", "utf8")).version')
          EXPECTED_VERSION="0.3.0"

          if [ "$CURRENT_VERSION" != "$EXPECTED_VERSION" ]; then
            echo "‚ùå Version mismatch - package.json has $CURRENT_VERSION but expected $EXPECTED_VERSION"
            echo "‚ÑπÔ∏è  This suggests the release workflow did not properly update package.json"
            exit 1
          fi

          echo "‚úÖ Package version verified: $CURRENT_VERSION"
          shell: /usr/bin/bash -e {0}
          env:
            CI: true
            BUN_INSTALL_CACHE_DIR: ~/.bun/install/cache
        ‚ùå Version mismatch - package.json has 0.2.0 but expected 0.3.0
        ‚ÑπÔ∏è  This suggests the release workflow did not properly update package.json
        Error: Process completed with exit code 1.

        Maybe we should use a different approach to version bumping. like using npm version command?
    status: completed
    dependencies:
    acceptance_criteria:
      - "the version bump works and the package.json is updated in an expected way"
    completed_at: 2026-01-29T14:30:00.000Z

  - id: task-019
    title: "fix npm publish"
    description: |
      see issue:
        Publishing v0.5.0 to NPM...
       Release type: minor
       npm warn publish npm auto-corrected some errors in your package.json when publishing.  Please run "npm pkg fix" to address these errors.
       npm warn publish errors corrected:
       npm warn publish "bin[hone]" script name was cleaned
       npm warn publish "repository.url" was normalized to "git+https://github.com/oskarhane/hone-ai.git"
       npm notice
       npm notice üì¶  hone-ai@0.5.0
       npm notice Tarball Contents
       npm notice 3.8kB README.md
       npm notice 1.3kB package.json
       npm notice 3.0kB src/agent-client.integration.test.ts
       npm notice 1.5kB src/agent-client.test.ts
       npm notice 6.2kB src/agent-client.ts
       npm notice 951B src/agent.test.ts
       npm notice 5.8kB src/agent.ts
       npm notice 11.2kB src/config.test.ts
       npm notice 5.0kB src/config.ts
       npm notice 9.3kB src/errors.test.ts
       npm notice 8.5kB src/errors.ts
       npm notice 12.8kB src/index.integration.test.ts
       npm notice 6.7kB src/index.ts
       npm notice 8.3kB src/integration-test.ts
       npm notice 2.6kB src/logger.test.ts
       npm notice 890B src/logger.ts
       npm notice 2.9kB src/prd-generator.integration.test.ts
       npm notice 1.1kB src/prd-generator.test.ts
       npm notice 13.5kB src/prd-generator.ts
       npm notice 4.4kB src/prds.test.ts
       npm notice 3.5kB src/prds.ts
       npm notice 8.1kB src/prompt.test.ts
       npm notice 8.9kB src/prompt.ts
       npm notice 3.4kB src/run.test.ts
       npm notice 9.7kB src/run.ts
       npm notice 5.6kB src/status.test.ts
       npm notice 2.5kB src/status.ts
       npm notice 3.1kB src/task-generator.test.ts
       npm notice 7.2kB src/task-generator.ts
       npm notice Tarball Details
       npm notice name: hone-ai
       npm notice version: 0.5.0
       npm notice filename: hone-ai-0.5.0.tgz
       npm notice package size: 36.8 kB
       npm notice unpacked size: 161.8 kB
       npm notice shasum: f46fde89c600f11adc5ac7aa031f6f255ed0c5ae
       npm notice integrity: sha512-AsZpIptmyW4ou[...]obgPGmmw3ezMQ==
       npm notice total files: 29
       npm notice
       npm error code ENEEDAUTH
       npm error need auth This command requires you to be logged in to https://registry.npmjs.org/
       npm error need auth You need to authorize this machine using `npm adduser`
       npm error A complete log of this run can be found in: /home/runner/.npm/_logs/2026-01-29T16_38_43_644Z-debug-0.log
       ‚ùå NPM publishing failed
       ‚ÑπÔ∏è  Check package.json configuration and npm registry permissions
       ‚ÑπÔ∏è  Version may already exist or package name may be taken
       ‚ÑπÔ∏è  Ensure trusted publisher is configured on npmjs.com for this repository
    status: completed
    dependencies:
    acceptance_criteria:
      - "publish to npm works"
    completed_at: 2026-01-29T17:15:00.000Z

  - id: task-020
    title: "the macos build on ci/cd pipeline doesn't work"
    description: |
      The macOS build on the CI/CD pipeline is not working as expected. This task aims to investigate and resolve the issue.
      the file is downloaded and placed in hone-v0.7.0-macos for you to check.
      how can we build for macos on linux? or are we able to get macos machines on github actions?
    status: completed
    dependencies:
    acceptance_criteria:
      - "builds for macos on github actions works"
    completed_at: 2026-01-29T17:30:00.000Z
