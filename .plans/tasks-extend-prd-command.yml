feature: extend-prd-command
prd: ./prd-extend-prd-command.md
created_at: 2026-02-05T17:24:03.523Z
updated_at: 2026-02-05T17:24:03.523Z

tasks:
  - id: task-001
    title: "Add extend-prd command structure to CLI"
    description: |
      Implement the basic command structure in src/index.ts using Commander.js. Add argument parsing for PRD file path and requirement description. Set up command validation and help text.
    status: completed
    dependencies: []
    acceptance_criteria:
      - "Command 'hone extend-prd' is recognized by CLI"
      - "Help text displays correctly with usage examples"
      - "Arguments are properly parsed and validated"
      - "Error handling for missing arguments is implemented"
      - "Command follows existing CLI patterns"
    completed_at: 2026-02-05T17:57:47.000Z

  - id: task-002
    title: "Create PRD file parser and validator"
    description: |
      Implement utilities to parse existing PRD markdown files and validate their structure. Create functions to identify sections (Functional Requirements, Non-Functional Requirements, etc.) and extract existing requirement IDs.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "Parser correctly identifies PRD sections"
      - "Validation detects malformed PRD files"
      - "Existing requirement IDs are extracted accurately"
      - "Section boundaries are properly identified"
      - "Error messages guide users for invalid files"
    completed_at: 2026-02-05T18:15:23.000Z

  - id: task-003
    title: "Create task file parser and ID management"
    description: |
      Implement utilities to parse existing task YAML files and extract task IDs. Create collision-free ID generation that continues from the highest existing task ID. Preserve existing task structure and metadata.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "Task file YAML parsing works correctly"
      - "Existing task IDs are extracted and analyzed"
      - "New task ID generation avoids collisions"
      - "Sequential numbering continues from highest existing ID"
      - "Existing task data remains unchanged"
    completed_at: 2026-02-05T22:15:00.000Z

  - id: task-004
    title: "Implement model configuration for extend-prd phase"
    description: |
      Extend the existing model resolution system to support 'extendPrd' phase-specific configuration. Follow the existing pattern in resolveModelForPhase() and integrate with the config validation system.
    status: completed
    dependencies:
      - task-001
    acceptance_criteria:
      - "extendPrd phase is recognized in config resolution"
      - "Fallback to prd phase model works correctly"
      - "Model resolution follows existing priority order"
      - "Config validation includes extendPrd phase"
      - "Integration with AgentClient works properly"
    completed_at: 2026-02-05T23:45:00.000Z

  - id: task-005
    title: "Create interactive Q&A refinement system"
    description: |
      Implement the clarifying question flow for new requirements using the existing PRD generation patterns. Reuse Q&A logic from prd-generator.ts and adapt it for requirement refinement rather than full PRD creation.
    status: completed
    dependencies:
      - task-002
      - task-004
    acceptance_criteria:
      - "Interactive Q&A session prompts user appropriately"
      - "Questions are relevant to the new requirement"
      - "User responses are captured and processed"
      - "Refinement improves requirement clarity"
      - "Q&A flow can be interrupted gracefully"
    completed_at: 2026-02-06T00:15:00.000Z

  - id: task-006
    title: "Implement file and URL content fetching"
    description: |
      Add support for processing file paths and URLs mentioned in requirement descriptions. Implement automatic content fetching and integration into the requirement context for better AI understanding.
    status: completed
    dependencies:
      - task-005
    acceptance_criteria:
      - "Local file paths are detected and content fetched"
      - "URLs are identified and content retrieved"
      - "Network errors are handled gracefully"
      - "File access permissions are validated"
      - "Content is integrated into requirement context"
    completed_at: 2026-02-06T01:45:00.000Z

  - id: task-007
    title: "Create PRD content appending system"
    description: |
      Implement logic to append new requirements to appropriate PRD sections while maintaining existing structure. Handle requirement numbering, section identification, and content formatting consistency.
    status: completed
    dependencies:
      - task-002
      - task-006
    acceptance_criteria:
      - "New requirements are added to correct sections"
      - "Requirement numbering follows existing patterns"
      - "Existing PRD content remains unmodified"
      - "Section formatting is preserved"
      - "Related sections are updated appropriately"
    completed_at: 2026-02-05T10:30:00.000Z

  - id: task-008
    title: "Implement incremental task generation"
    description: |
      Adapt the existing task generation logic to create tasks only for new requirements. Analyze dependencies between new and existing tasks. Reuse patterns from task-generator.ts while ensuring only incremental tasks are created.
    status: completed
    dependencies:
      - task-003
      - task-007
    acceptance_criteria:
      - "Only new requirement tasks are generated"
      - "Task dependencies are analyzed correctly"
      - "New tasks integrate with existing task structure"
      - "Task format matches existing patterns"
      - "Acceptance criteria are specific and testable"
    completed_at: 2026-02-05T12:15:00.000Z

  - id: task-009
    title: "Create atomic file operation system"
    description: |
      Implement atomic file operations to prevent corruption during PRD and task file updates. Use temporary files and atomic moves to ensure data integrity even if the process is interrupted.
    status: pending
    dependencies:
      - task-007
      - task-008
    acceptance_criteria:
      - "File operations are atomic and safe"
      - "Temporary files are used for modifications"
      - "Rollback capability exists for failed operations"
      - "Concurrent access is handled properly"
      - "Data integrity is maintained during interruptions"
    completed_at: null

  - id: task-010
    title: "Implement task file metadata updates"
    description: |
      Update task file metadata (updated_at timestamp, task count, etc.) when new tasks are added. Ensure metadata accuracy and consistency with the existing task file structure.
    status: pending
    dependencies:
      - task-008
      - task-009
    acceptance_criteria:
      - "updated_at timestamp is set correctly"
      - "Task count metadata is accurate"
      - "Metadata format matches existing structure"
      - "Metadata updates are included in atomic operations"
      - "Existing metadata fields are preserved"
    completed_at: null

  - id: task-011
    title: "Add comprehensive error handling and validation"
    description: |
      Implement robust error handling for all failure scenarios including missing files, invalid formats, network errors, and file access issues. Provide clear, actionable error messages.
    status: pending
    dependencies:
      - task-009
      - task-010
    acceptance_criteria:
      - "All error scenarios have appropriate handling"
      - "Error messages are clear and actionable"
      - "Validation catches common user mistakes"
      - "Graceful degradation for non-critical errors"
      - "Error logging follows existing patterns"
    completed_at: null

  - id: task-012
    title: "Create comprehensive test suite"
    description: |
      Write unit and integration tests covering all extend-prd functionality including file parsing, task generation, error scenarios, and atomic operations. Follow existing test patterns using Bun's test runner.
    status: pending
    dependencies:
      - task-011
    acceptance_criteria:
      - "Unit tests cover all core functions"
      - "Integration tests validate end-to-end flow"
      - "Error scenarios are tested thoroughly"
      - "Test coverage meets project standards"
      - "Tests follow existing project patterns"
    completed_at: null

  - id: task-013
    title: "Add documentation and usage examples"
    description: |
      Create comprehensive documentation for the extend-prd command including usage examples, configuration options, and troubleshooting guide. Update CLI help text and project documentation.
    status: pending
    dependencies:
      - task-012
    acceptance_criteria:
      - "Command usage is clearly documented"
      - "Configuration options are explained"
      - "Examples demonstrate common use cases"
      - "Troubleshooting guide addresses common issues"
      - "Integration with existing documentation is seamless"
    completed_at: null
